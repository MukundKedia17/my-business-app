# Create the complete corrected ERP application code with real Firebase configuration

html_code = '''<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- Instructions for Mobile App Experience -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Aqua Trust ERP">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/818cf8/ffffff?text=AT">
    
    <title>Aqua Trust Business ERP Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
        // === REAL FIREBASE CONFIGURATION ===
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, where, orderBy, doc, setDoc, getDocs, deleteDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your REAL Firebase Configuration
        const firebaseConfig = {
          apiKey: "AIzaSyCzZ6tqTM9QjyHKX2iIM1y_NLK0mepbhPA",
          authDomain: "my-business-app-2025.firebaseapp.com",
          projectId: "my-business-app-2025",
          storageBucket: "my-business-app-2025.firebasestorage.app",
          messagingSenderId: "532223399247",
          appId: "1:532223399247:web:aad37bc8342e6d0a91a13a",
          measurementId: "G-6498RK338P"
        };

        // === GLOBAL STATE ===
        let userId;
        let currentUser = null;
        let transactions = [];
        let products = [
            { id: 'prod001', name: 'White Phenyl', standardCost: 50 },
            { id: 'prod002', name: 'Toilet Cleaner', standardCost: 60 },
            { id: 'prod003', name: 'Handwash', standardCost: 40 },
            { id: 'prod004', name: 'Floor Cleaner', standardCost: 45 },
            { id: 'prod005', name: 'Glass Cleaner', standardCost: 35 }
        ];
        let parties = [];
        let db, auth;

        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', () => {
            const statusBar = document.getElementById('status-bar');

            try {
                statusBar.textContent = "üîÑ Connecting to Aqua Trust database...";
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Authentication state listener
                onAuthStateChanged(auth, async user => {
                    if (user) {
                        userId = user.uid;
                        currentUser = user;
                        statusBar.textContent = "‚úÖ Connected successfully! Welcome to Aqua Trust ERP";
                        statusBar.className = "p-4 mb-4 text-center rounded-lg shadow bg-green-100 text-green-800";
                        
                        initDashboard();
                        updateUserInfo();
                        
                        setTimeout(() => { statusBar.classList.add('hidden'); }, 2000);
                    } else {
                        statusBar.textContent = "üîê Setting up secure session...";
                        statusBar.className = "p-4 mb-4 text-center rounded-lg shadow bg-blue-100 text-blue-800";
                        showAuthForm();
                    }
                });
            } catch (error) {
                console.error("Firebase initialization error:", error);
                statusBar.innerHTML = `<h3 class="font-bold text-red-600">‚ö†Ô∏è Connection Error</h3><p class="text-sm mt-1">${error.message}</p>`;
                statusBar.className = "p-4 mb-4 text-center rounded-lg shadow bg-red-100 text-red-800";
            }
        });

        // === AUTHENTICATION FUNCTIONS ===
        function showAuthForm() {
            document.getElementById('authForm').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function hideAuthForm() {
            document.getElementById('authForm').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }

        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            if (currentUser) {
                if (currentUser.isAnonymous) {
                    userInfo.innerHTML = `<span class="text-sm text-gray-600">üë§ Guest User | </span><button onclick="signOutUser()" class="text-sm text-red-600 hover:text-red-800">Sign Out</button>`;
                } else {
                    userInfo.innerHTML = `<span class="text-sm text-gray-600">üë§ ${currentUser.email} | </span><button onclick="signOutUser()" class="text-sm text-red-600 hover:text-red-800">Sign Out</button>`;
                }
            }
        }

        async function signInAnonymous() {
            try {
                await signInAnonymously(auth);
                showNotification("‚úÖ Signed in as Guest", "bg-green-500");
            } catch (error) {
                showNotification("‚ùå Error: " + error.message, "bg-red-500");
            }
        }

        async function registerUser() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            if (!email || !password) {
                showNotification("‚ö†Ô∏è Please enter email and password", "bg-red-500");
                return;
            }

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showNotification("‚úÖ Account created successfully!", "bg-green-500");
            } catch (error) {
                showNotification("‚ùå Registration failed: " + error.message, "bg-red-500");
            }
        }

        async function signInUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showNotification("‚ö†Ô∏è Please enter email and password", "bg-red-500");
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showNotification("‚úÖ Welcome back to Aqua Trust!", "bg-green-500");
            } catch (error) {
                showNotification("‚ùå Login failed: " + error.message, "bg-red-500");
            }
        }

        async function signOutUser() {
            try {
                await signOut(auth);
                showNotification("‚úÖ Signed out successfully", "bg-green-500");
                showAuthForm();
            } catch (error) {
                showNotification("‚ùå Sign out failed: " + error.message, "bg-red-500");
            }
        }

        // Make auth functions globally available
        window.signInAnonymous = signInAnonymous;
        window.registerUser = registerUser;
        window.signInUser = signInUser;
        window.signOutUser = signOutUser;

        // === DASHBOARD INITIALIZATION ===
        function initDashboard() {
            setupTabSwitching();
            setupListeners();
            document.getElementById('dataEntryForm').addEventListener('submit', handleDataEntry);
            document.getElementById('allTransactionsTableBody').addEventListener('click', handleTableActions);
            document.getElementById('partyLedgerSelect').addEventListener('change', (e) => renderPartyLedger(e.target.value));
            document.getElementById('chatbotForm').addEventListener('submit', handleChatbotInput);
            hideAuthForm();
        }

        function setupTabSwitching() {
            const tabs = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('bg-indigo-600', 'text-white'));
                    tab.classList.add('bg-indigo-600', 'text-white');
                    const target = tab.dataset.tab;
                    tabContents.forEach(content => { content.classList.toggle('hidden', content.id !== target); });
                });
            });
            document.getElementById('dataEntryTab').click();
        }
        
        function getCollectionPath(collectionName) {
            return `users/${userId}/${collectionName}`;
        }
        
        function setupListeners() {
            if (!userId) return;
            populateProductDropdowns();
            
            const transactionsCol = collection(db, getCollectionPath('transactions'));
            const q = query(transactionsCol, orderBy('date', 'desc'));
            onSnapshot(q, (snapshot) => {
                transactions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateAllTabs();
            }, (err) => { 
                console.error("Transaction listener error:", err);
                showNotification("‚ö†Ô∏è Connection issue with transactions", "bg-yellow-500");
            });

            const partiesCol = collection(db, getCollectionPath('parties'));
            onSnapshot(query(partiesCol), (snapshot) => {
                parties = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                populatePartyLedgerDropdown();
            }, (err) => { 
                console.error("Party listener error:", err);
                showNotification("‚ö†Ô∏è Connection issue with parties", "bg-yellow-500");
            });
        }
        
        function updateAllTabs() {
            renderAllTransactionsTable();
            renderSalesReports();
            renderInventoryReport();
            renderUnitEconomics();
            renderFinancialStatements();
        }

        // === DATA ENTRY FUNCTIONS ===
        async function handleDataEntry(e) {
            e.preventDefault();
            if (!userId) { 
                showNotification('‚ö†Ô∏è Please sign in first', "bg-red-500"); 
                return; 
            }
            
            const form = e.target;
            const transactionId = form.editTransactionId.value;

            const transaction = {
                date: form.date.value, 
                type: form.type.value,
                product: form.product.value, 
                quantity: parseInt(form.quantity.value) || 0,
                amount: parseFloat(form.amount.value), 
                party: form.party.value.trim(),
                description: form.description.value || form.type.value,
                timestamp: serverTimestamp(),
                userId: userId
            };

            try {
                if (transactionId) {
                    const transactionRef = doc(db, getCollectionPath('transactions'), transactionId);
                    await updateDoc(transactionRef, transaction);
                    await deleteJournalEntriesForTransaction(transactionId);
                    await createJournalEntries(transaction, transactionId);
                    showNotification('‚úÖ Transaction updated successfully!');
                } else {
                    const transactionsCol = collection(db, getCollectionPath('transactions'));
                    const docRef = await addDoc(transactionsCol, transaction);
                    await createJournalEntries(transaction, docRef.id);
                    await updateParty(transaction.party, transaction.type);
                    showNotification('‚úÖ Transaction saved successfully!');
                }
                resetForm();
            } catch (err) {
                console.error("Error saving data:", err);
                showNotification("‚ùå Failed to save transaction: " + err.message, "bg-red-500");
            }
        }

        // === TABLE FUNCTIONS ===
        function renderAllTransactionsTable() {
            const tableBody = document.getElementById('allTransactionsTableBody');
            tableBody.innerHTML = '';
            transactions.forEach(tx => {
                const displayParty = tx.party || 'Cash Sale';
                tableBody.innerHTML += `<tr class="border-b hover:bg-gray-50">
                    <td class="py-2 px-3 text-xs">${tx.date}</td>
                    <td class="py-2 px-3">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getTypeColor(tx.type)}">
                            ${tx.type.charAt(0).toUpperCase() + tx.type.slice(1)}
                        </span>
                    </td>
                    <td class="py-2 px-3">${displayParty}</td>
                    <td class="py-2 px-3">${tx.product || '-'}</td>
                    <td class="py-2 px-3 text-center">${tx.quantity || '-'}</td>
                    <td class="py-2 px-3 text-right font-medium">‚Çπ${tx.amount.toFixed(2)}</td>
                    <td class="py-2 px-3 text-center space-x-2">
                        <button data-id="${tx.id}" class="modify-btn text-blue-500 hover:text-blue-700 text-xs font-medium">Edit</button>
                        <button data-id="${tx.id}" class="delete-btn text-red-500 hover:text-red-700 text-xs font-medium">Delete</button>
                    </td>
                </tr>`;
            });
        }

        function getTypeColor(type) {
            const colors = {
                'sale': 'bg-green-100 text-green-800',
                'purchase': 'bg-blue-100 text-blue-800',
                'expense': 'bg-red-100 text-red-800',
                'payment_received': 'bg-green-100 text-green-800',
                'payment_made': 'bg-red-100 text-red-800'
            };
            return colors[type] || 'bg-gray-100 text-gray-800';
        }
        
        async function handleTableActions(e) {
            const target = e.target;
            const txId = target.dataset.id;
            if (!txId) return;

            if (target.classList.contains('delete-btn')) {
                if (confirm('Are you sure you want to delete this transaction?')) {
                    try {
                        await deleteJournalEntriesForTransaction(txId);
                        await deleteDoc(doc(db, getCollectionPath('transactions'), txId));
                        showNotification('‚úÖ Transaction deleted successfully!', 'bg-orange-500');
                    } catch (error) {
                        showNotification('‚ùå Failed to delete: ' + error.message, 'bg-red-500');
                    }
                }
            } else if (target.classList.contains('modify-btn')) {
                const txToModify = transactions.find(t => t.id === txId);
                if (txToModify) {
                    const form = document.getElementById('dataEntryForm');
                    form.date.value = txToModify.date;
                    form.type.value = txToModify.type;
                    form.party.value = txToModify.party;
                    form.product.value = txToModify.product;
                    form.quantity.value = txToModify.quantity;
                    form.amount.value = txToModify.amount;
                    form.description.value = txToModify.description;
                    form.editTransactionId.value = txId;
                    form.querySelector('button[type="submit"]').textContent = 'Update Transaction';
                    document.getElementById('dataEntryTab').click();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        }
        
        async function deleteJournalEntriesForTransaction(txId) {
            const journalCol = collection(db, getCollectionPath('journal'));
            const q = query(journalCol, where('transactionId', '==', txId));
            const journalSnapshot = await getDocs(q);
            const deletePromises = [];
            journalSnapshot.forEach(doc => deletePromises.push(deleteDoc(doc.ref)));
            await Promise.all(deletePromises);
        }

        function resetForm() {
            const form = document.getElementById('dataEntryForm');
            form.reset();
            form.editTransactionId.value = '';
            form.querySelector('button[type="submit"]').textContent = 'Save Transaction';
            document.getElementById('date').valueAsDate = new Date();
        }

        // === CHATBOT FUNCTIONS ===
        async function handleChatbotInput(e) {
            e.preventDefault();
            const input = document.getElementById('chatbotInput');
            const text = input.value.trim();
            if (!text) return;

            addChatMessage('user', text);
            const parsedTx = parseTransactionFromText(text);

            if (parsedTx.error) {
                addChatMessage('bot', `Sorry, I couldn't understand. ${parsedTx.error}`);
            } else {
                const confirmationMsg = `‚úÖ Recorded: ${parsedTx.type} of ${parsedTx.quantity} ${parsedTx.product} for ‚Çπ${parsedTx.amount.toFixed(2)} on ${parsedTx.date}`;
                addChatMessage('bot', confirmationMsg);
                
                try {
                    const transactionsCol = collection(db, getCollectionPath('transactions'));
                    parsedTx.timestamp = serverTimestamp();
                    parsedTx.userId = userId;
                    const docRef = await addDoc(transactionsCol, parsedTx);
                    await createJournalEntries(parsedTx, docRef.id);
                    await updateParty(parsedTx.party, parsedTx.type);
                    showNotification('‚úÖ Transaction saved via Chatbot!');
                } catch (error) {
                    addChatMessage('bot', '‚ùå Failed to save transaction: ' + error.message);
                }
            }
            input.value = '';
        }

        function parseTransactionFromText(text) {
            text = text.toLowerCase();
            let type, product, quantity, amount, party = '', date = new Date();

            const saleWords = ['sell', 'sold', 'becha', 'deliver', 'sale'];
            const purchaseWords = ['buy', 'bought', 'purchase', 'kharida', 'purchased from', 'get from'];

            if (saleWords.some(word => text.includes(word))) { 
                type = 'sale';
            } else if (purchaseWords.some(word => text.includes(word))) { 
                type = 'purchase';
            } else { 
                return { error: "Please use words like 'buy', 'sell', 'purchase', 'deliver'." }; 
            }

            // Date parsing
            if (text.includes('tomorrow') || text.includes('kal')) { 
                date.setDate(date.getDate() + 1);
            } else if (text.includes('yesterday')) { 
                date.setDate(date.getDate() - 1);
            }
            
            const finalDateString = date.toISOString().split('T')[0];

            // Product matching
            const foundProduct = products.find(p => text.includes(p.name.toLowerCase()));
            if (!foundProduct) { 
                return { error: `Product not found. Available: ${products.map(p=>p.name).join(', ')}.` }; 
            }
            product = foundProduct.name;

            // Party extraction
            const toMatch = text.match(/(?:to|for)\\s([\\w\\s]+?)(?=\\s@|\\sfor|\\s$)/);
            const fromMatch = text.match(/from\\s([\\w\\s]+?)(?=\\s@|\\sfor|\\s$)/);

            if (type === 'sale' && toMatch) {
                party = toMatch[1].replace(product.toLowerCase(), '').trim();
            } else if (type === 'purchase' && fromMatch) {
                party = fromMatch[1].replace(product.toLowerCase(), '').trim();
            }

            // Quantity and amount parsing
            const pattern1 = /(\\d+)\\s*.*?\\s*@\\s*(\\d+(\\.\\d+)?)/; 
            const pattern2 = /(\\d+)\\s*.*?\\s*for\\s*(\\d+(\\.\\d+)?)/;

            let match;
            if ((match = text.match(pattern1))) {
                quantity = parseInt(match[1], 10);
                const pricePerUnit = parseFloat(match[2]);
                amount = quantity * pricePerUnit;
            } else if ((match = text.match(pattern2))) {
                quantity = parseInt(match[1], 10);
                amount = parseFloat(match[2]);
            } else {
                 const numbers = text.match(/\\d+(\\.\\d+)?/g)?.map(Number) || [];
                 if(numbers.length < 2) return { error: "Please provide both quantity and price/amount." };
                 quantity = numbers[0];
                 amount = numbers[1];
            }
            
            if (!quantity || !amount) return { error: "Could not determine quantity or amount." };

            return { 
                date: finalDateString, 
                type, 
                product, 
                quantity, 
                amount, 
                party: party || 'Cash', 
                description: `Chatbot Entry: ${text}` 
            };
        }

        function addChatMessage(sender, message) {
            const chatbox = document.getElementById('chatbox');
            const bubble = document.createElement('div');
            bubble.textContent = message;
            if (sender === 'user') { 
                bubble.className = 'bg-indigo-500 text-white p-3 rounded-lg self-end max-w-xs mb-2 ml-auto';
            } else { 
                bubble.className = 'bg-gray-200 text-gray-800 p-3 rounded-lg self-start max-w-xs mb-2'; 
            }
            chatbox.appendChild(bubble);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        // === BUSINESS LOGIC FUNCTIONS ===
        function getAvgCostForProduct(productName) {
            const purchases = transactions.filter(t => t.type === 'purchase' && t.product === productName);
            if (purchases.length === 0) return products.find(p=>p.name === productName)?.standardCost || 0;
            const totalCost = purchases.reduce((sum, t) => sum + t.amount, 0);
            const totalQty = purchases.reduce((sum, t) => sum + t.quantity, 0);
            return totalQty > 0 ? totalCost / totalQty : 0;
        }

        function renderInventoryReport() {
            const inventoryBody = document.getElementById('inventoryReportBody');
            inventoryBody.innerHTML = '';
            let grandTotalValue = 0;
            
            products.forEach(product => {
                const purchases = transactions.filter(t => t.type === 'purchase' && t.product === product.name)
                    .reduce((sum, t) => sum + t.quantity, 0);
                const sales = transactions.filter(t => t.type === 'sale' && t.product === product.name)
                    .reduce((sum, t) => sum + t.quantity, 0);
                const closingStock = purchases - sales;
                const avgCost = getAvgCostForProduct(product.name);
                const stockValue = closingStock * avgCost;
                grandTotalValue += stockValue;
                
                const stockClass = closingStock > 10 ? 'text-green-600' : closingStock > 5 ? 'text-yellow-600' : 'text-red-600';
                
                inventoryBody.innerHTML += `<tr class="border-b hover:bg-gray-50">
                    <td class="py-2 px-4 font-medium">${product.name}</td>
                    <td class="py-2 px-4 text-center text-blue-600">${purchases}</td>
                    <td class="py-2 px-4 text-center text-red-600">${sales}</td>
                    <td class="py-2 px-4 text-center font-bold ${stockClass}">${closingStock}</td>
                    <td class="py-2 px-4 text-right font-medium">‚Çπ${stockValue.toFixed(2)}</td>
                </tr>`;
            });
            document.getElementById('totalInventoryValue').textContent = `‚Çπ${grandTotalValue.toFixed(2)}`;
        }

        function renderUnitEconomics() {
            const economicsBody = document.getElementById('unitEconomicsBody');
            economicsBody.innerHTML = '';
            
            products.forEach(product => {
                const salesTx = transactions.filter(t => t.type === 'sale' && t.product === product.name);
                const totalRevenue = salesTx.reduce((sum, t) => sum + t.amount, 0);
                const totalQtySold = salesTx.reduce((sum, t) => sum + t.quantity, 0);
                const avgSellPrice = totalQtySold > 0 ? totalRevenue / totalQtySold : 0;
                
                const avgCostPrice = getAvgCostForProduct(product.name);
                const profit = avgSellPrice - avgCostPrice;
                const margin = avgSellPrice > 0 ? (profit / avgSellPrice) * 100 : 0;

                economicsBody.innerHTML += `<tr class="border-b hover:bg-gray-50">
                    <td class="py-2 px-4 font-medium">${product.name}</td>
                    <td class="py-2 px-4 text-right">‚Çπ${avgSellPrice.toFixed(2)}</td>
                    <td class="py-2 px-4 text-right">‚Çπ${avgCostPrice.toFixed(2)}</td>
                    <td class="py-2 px-4 text-right font-bold ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">‚Çπ${profit.toFixed(2)}</td>
                    <td class="py-2 px-4 text-right font-bold ${margin >= 0 ? 'text-blue-600' : 'text-red-600'}">${margin.toFixed(2)}%</td>
                </tr>`;
            });
        }
        
        async function createJournalEntries(tx, txId) {
            const journalCol = collection(db, getCollectionPath('journal'));
            let costOfGoodsSold = 0;
            
            if (tx.type === 'sale' && tx.product && tx.quantity > 0) {
                const avgCost = getAvgCostForProduct(tx.product);
                costOfGoodsSold = avgCost * tx.quantity;
            }

            let entries = [];
            const baseEntry = { 
                date: tx.date, 
                transactionId: txId, 
                narration: tx.description,
                timestamp: serverTimestamp()
            };
            
            switch(tx.type) {
                case 'sale':
                    entries.push({ ...baseEntry, account: tx.party || 'Cash/Bank', debit: tx.amount, credit: 0 });
                    entries.push({ ...baseEntry, account: 'Sales', debit: 0, credit: tx.amount });
                    if(costOfGoodsSold > 0) {
                        entries.push({ ...baseEntry, account: 'Cost of Goods Sold', debit: costOfGoodsSold, credit: 0 });
                        entries.push({ ...baseEntry, account: 'Inventory', debit: 0, credit: costOfGoodsSold });
                    }
                    break;
                case 'purchase': 
                    entries.push({ ...baseEntry, account: 'Inventory', debit: tx.amount, credit: 0 }); 
                    entries.push({ ...baseEntry, account: tx.party || 'Cash/Bank', debit: 0, credit: tx.amount }); 
                    break;
                case 'expense': 
                    entries.push({ ...baseEntry, account: tx.description || 'General Expense', debit: tx.amount, credit: 0 }); 
                    entries.push({ ...baseEntry, account: 'Cash/Bank', debit: 0, credit: tx.amount }); 
                    break;
                case 'payment_received': 
                    entries.push({ ...baseEntry, account: 'Cash/Bank', debit: tx.amount, credit: 0 }); 
                    entries.push({ ...baseEntry, account: tx.party, debit: 0, credit: tx.amount }); 
                    break;
                case 'payment_made': 
                    entries.push({ ...baseEntry, account: tx.party, debit: tx.amount, credit: 0 }); 
                    entries.push({ ...baseEntry, account: 'Cash/Bank', debit: 0, credit: tx.amount }); 
                    break;
            }
            
            for (const entry of entries) { 
                if(entry.account) await addDoc(journalCol, entry); 
            }
        }
        
        async function updateParty(partyName, type) { 
            if (!partyName) return; 
            const partyType = (type === 'sale' || type === 'payment_received') ? 'Customer' : 'Supplier'; 
            const partyRef = doc(db, getCollectionPath('parties'), partyName); 
            await setDoc(partyRef, { name: partyName, type: partyType, timestamp: serverTimestamp() }, { merge: true }); 
        }
        
        function populateProductDropdowns() { 
            const productSelect = document.getElementById('product'); 
            if (productSelect) { 
                productSelect.innerHTML = `<option value="">Select Product</option>` + 
                    products.map(p => `<option value="${p.name}">${p.name}</option>`).join(''); 
            } 
        }
        
        function renderSalesReports() { 
            const salesBody = document.getElementById('salesReportBody'); 
            salesBody.innerHTML = ''; 
            let totalRevenue = 0; 
            
            const salesTransactions = transactions.filter(t => t.type === 'sale'); 
            salesTransactions.forEach(tx => { 
                totalRevenue += tx.amount; 
                salesBody.innerHTML += `<tr class="border-b hover:bg-gray-50">
                    <td class="py-2 px-4">${tx.date}</td>
                    <td class="py-2 px-4">${tx.party || 'Cash Sale'}</td>
                    <td class="py-2 px-4">${tx.product}</td>
                    <td class="py-2 px-4 text-center">${tx.quantity}</td>
                    <td class="py-2 px-4 text-right font-medium">‚Çπ${tx.amount.toFixed(2)}</td>
                </tr>`; 
            }); 
            document.getElementById('totalSalesRevenue').textContent = `‚Çπ${totalRevenue.toFixed(2)}`; 
        }
        
        async function renderFinancialStatements() { 
            if (!userId) return; 
            const journalCol = collection(db, getCollectionPath('journal')); 
            const journalSnapshot = await getDocs(query(journalCol)); 
            const journalEntries = journalSnapshot.docs.map(d => d.data()); 
            renderJournal(journalEntries); 
            const trialBalance = generateTrialBalance(journalEntries); 
            renderTrialBalance(trialBalance); 
            renderPandL(trialBalance); 
            renderBalanceSheet(trialBalance); 
        }
        
        function renderJournal(entries) { 
            const journalBody = document.getElementById('journalBody'); 
            journalBody.innerHTML = ''; 
            entries.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(entry => { 
                journalBody.innerHTML += `<tr class="border-b text-sm">
                    <td class="py-1 px-2">${entry.date}</td>
                    <td class="py-1 px-2">${entry.account}</td>
                    <td class="py-1 px-2 text-right">${entry.debit > 0 ? `‚Çπ${entry.debit.toFixed(2)}` : ''}</td>
                    <td class="py-1 px-2 text-right">${entry.credit > 0 ? `‚Çπ${entry.credit.toFixed(2)}` : ''}</td>
                </tr>`; 
            }); 
        }
        
        function generateTrialBalance(entries) { 
            const accounts = {}; 
            entries.forEach(entry => { 
                if (!accounts[entry.account]) accounts[entry.account] = { debit: 0, credit: 0 }; 
                accounts[entry.account].debit += entry.debit; 
                accounts[entry.account].credit += entry.credit; 
            }); 
            return accounts; 
        }
        
        function renderTrialBalance(trialBalance) { 
            const tbBody = document.getElementById('trialBalanceBody'); 
            tbBody.innerHTML = ''; 
            let totalDebit = 0, totalCredit = 0; 
            Object.keys(trialBalance).sort().forEach(acc => { 
                totalDebit += trialBalance[acc].debit; 
                totalCredit += trialBalance[acc].credit; 
                tbBody.innerHTML += `<tr class="border-b text-sm">
                    <td class="py-1 px-2">${acc}</td>
                    <td class="py-1 px-2 text-right">‚Çπ${trialBalance[acc].debit.toFixed(2)}</td>
                    <td class="py-1 px-2 text-right">‚Çπ${trialBalance[acc].credit.toFixed(2)}</td>
                </tr>`; 
            }); 
            document.getElementById('tbTotalDebit').textContent = `‚Çπ${totalDebit.toFixed(2)}`; 
            document.getElementById('tbTotalCredit').textContent = `‚Çπ${totalCredit.toFixed(2)}`; 
        }
        
        function renderPandL(trialBalance) { 
            const sales = trialBalance['Sales'] ? trialBalance['Sales'].credit - trialBalance['Sales'].debit : 0; 
            const cogs = trialBalance['Cost of Goods Sold'] ? trialBalance['Cost of Goods Sold'].debit - trialBalance['Cost of Goods Sold'].credit : 0; 
            const grossProfit = sales - cogs; 
            let expenses = 0; 
            for (const acc in trialBalance) { 
                if (acc.toLowerCase().includes('expense')) { 
                    expenses += trialBalance[acc].debit - trialBalance[acc].credit; 
                } 
            } 
            const netProfit = grossProfit - expenses; 
            document.getElementById('plSales').textContent = `‚Çπ${sales.toFixed(2)}`; 
            document.getElementById('plCogs').textContent = `‚Çπ${cogs.toFixed(2)}`; 
            document.getElementById('plGrossProfit').textContent = `‚Çπ${grossProfit.toFixed(2)}`; 
            document.getElementById('plExpenses').textContent = `‚Çπ${expenses.toFixed(2)}`; 
            document.getElementById('plNetProfit').textContent = `‚Çπ${netProfit.toFixed(2)}`; 
        }
        
        function renderBalanceSheet(trialBalance) { 
            const cash = trialBalance['Cash/Bank'] ? trialBalance['Cash/Bank'].debit - trialBalance['Cash/Bank'].credit : 0; 
            const inventory = trialBalance['Inventory'] ? trialBalance['Inventory'].debit - trialBalance['Inventory'].credit : 0; 
            document.getElementById('bsCash').textContent = `‚Çπ${cash.toFixed(2)}`; 
            document.getElementById('bsInventory').textContent = `‚Çπ${inventory.toFixed(2)}`; 
        }
        
        function populatePartyLedgerDropdown() { 
            const select = document.getElementById('partyLedgerSelect'); 
            select.innerHTML = '<option value="">Select Party</option>' + 
                parties.map(p => `<option value="${p.name}">${p.name} (${p.type})</option>`).join(''); 
        }
        
        async function renderPartyLedger(partyName) { 
            const ledgerBody = document.getElementById('partyLedgerBody'); 
            ledgerBody.innerHTML = ''; 
            if (!partyName) return; 
            
            const q = query(collection(db, getCollectionPath('journal')), where('account', '==', partyName), orderBy('date')); 
            const snapshot = await getDocs(q); 
            let balance = 0; 
            snapshot.docs.forEach(doc => { 
                const entry = doc.data(); 
                balance += entry.debit - entry.credit; 
                ledgerBody.innerHTML += `<tr class="border-b text-sm">
                    <td class="py-1 px-2">${entry.date}</td>
                    <td class="py-1 px-2">${entry.narration || ''}</td>
                    <td class="py-1 px-2 text-right">${entry.debit > 0 ? `‚Çπ${entry.debit.toFixed(2)}` : ''}</td>
                    <td class="py-1 px-2 text-right">${entry.credit > 0 ? `‚Çπ${entry.credit.toFixed(2)}` : ''}</td>
                    <td class="py-1 px-2 text-right font-bold">‚Çπ${balance.toFixed(2)}</td>
                </tr>`; 
            }); 
        }
        
        function showNotification(message, bgColor = 'bg-green-500') { 
            const notification = document.getElementById('notification'); 
            notification.textContent = message; 
            notification.className = `fixed top-5 right-5 text-white py-3 px-6 rounded-lg shadow-lg ${bgColor} z-50 max-w-md`; 
            notification.classList.remove('hidden');
            setTimeout(() => { 
                notification.classList.add('hidden'); 
            }, 4000); 
        }

    </script>
    <style> 
        body { font-family: 'Inter', sans-serif; } 
        .tab-btn { transition: all 0.2s ease-in-out; } 
        .tab-btn:hover { background-color: #f3f4f6; }
        #chatbox { max-height: 300px; }
        .auth-card { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="notification" class="hidden"></div>
    
    <!-- Authentication Form -->
    <div id="authForm" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-100 to-blue-100">
        <div class="auth-card bg-white p-8 rounded-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Aqua Trust ERP</h1>
                <p class="text-gray-600 mt-2">Welcome to your FMCG Business Manager</p>
            </div>
            
            <div class="space-y-6">
                <!-- Login Form -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Sign In</h3>
                    <div class="space-y-3">
                        <input type="email" id="loginEmail" placeholder="Enter your email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                        <input type="password" id="loginPassword" placeholder="Enter your password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                        <button onclick="signInUser()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-200">Sign In</button>
                    </div>
                </div>
                
                <div class="text-center text-gray-500">or</div>
                
                <!-- Registration Form -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">Create Account</h3>
                    <div class="space-y-3">
                        <input type="email" id="registerEmail" placeholder="Enter your email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                        <input type="password" id="registerPassword" placeholder="Create password (min 6 chars)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                        <button onclick="registerUser()" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition duration-200">Create Account</button>
                    </div>
                </div>
                
                <div class="text-center text-gray-500">or</div>
                
                <!-- Guest Access -->
                <div class="text-center">
                    <button onclick="signInAnonymous()" class="bg-gray-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-700 transition duration-200">Continue as Guest</button>
                    <p class="text-xs text-gray-500 mt-2">Limited features available</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <div class="container mx-auto p-4 sm:p-2">
            <div id="status-bar" class="p-4 mb-4 text-center rounded-lg shadow bg-blue-100 text-blue-800"></div>
            
            <header class="mb-4 flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">üè¢ Aqua Trust ERP</h1>
                    <p class="text-gray-500">Complete FMCG Business Management System</p>
                </div>
                <div id="userInfo" class="text-right"></div>
            </header>

            <div class="bg-white rounded-lg shadow-md p-2 mb-6">
                <nav class="flex flex-col sm:flex-row sm:space-x-1">
                    <button id="dataEntryTab" data-tab="dataEntryContent" class="tab-btn flex-1 py-2 px-3 rounded-md text-sm font-medium text-gray-600 hover:bg-indigo-100">üìù Data Entry</button>
                    <button data-tab="salesReportContent" class="tab-btn flex-1 py-2 px-3 rounded-md text-sm font-medium text-gray-600 hover:bg-indigo-100">üìä Sales Report</button>
                    <button data-tab="inventoryContent" class="tab-btn flex-1 py-2 px-3 rounded-md text-sm font-medium text-gray-600 hover:bg-indigo-100">üì¶ Inventory</button>
                    <button data-tab="economicsContent" class="tab-btn flex-1 py-2 px-3 rounded-md text-sm font-medium text-gray-600 hover:bg-indigo-100">üí∞ Economics</button>
                    <button data-tab="financialsContent" class="tab-btn flex-1 py-2 px-3 rounded-md text-sm font-medium text-gray-600 hover:bg-indigo-100">üìà Financials</button>
                </nav>
            </div>

            <main>
                <div id="dataEntryContent" class="tab-content hidden space-y-6">
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold mb-4">üÜï Add New Transaction</h2>
                            <form id="dataEntryForm" class="space-y-4">
                                <input type="hidden" id="editTransactionId" name="editTransactionId">
                                <input type="date" id="date" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none" value="">
                                <script>document.getElementById('date').valueAsDate = new Date();</script>
                                
                                <select id="type" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"> 
                                    <option value="sale">üí∞ Sale</option> 
                                    <option value="purchase">üõí Purchase</option> 
                                    <option value="expense">üí≥ Expense</option> 
                                    <option value="payment_received">üíµ Payment Received</option> 
                                    <option value="payment_made">üí∏ Payment Made</option> 
                                </select>
                                
                                <input type="text" id="party" placeholder="Customer/Supplier Name" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                <select id="product" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"></select>
                                <input type="number" id="quantity" placeholder="Quantity" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                <input type="number" id="amount" step="0.01" placeholder="Total Amount (‚Çπ)" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                <textarea id="description" placeholder="Description (optional)..." class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"></textarea>
                                <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-200">üíæ Save Transaction</button>
                            </form>
                        </div>
                         <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold mb-4">ü§ñ Chat Assistant</h2>
                            <div class="h-96 bg-gray-50 border border-gray-200 rounded-lg p-4 flex flex-col justify-between">
                                <div id="chatbox" class="flex-grow overflow-y-auto flex flex-col space-y-2">
                                    <div class="bg-gray-200 text-gray-800 p-3 rounded-lg self-start max-w-xs mb-2">
                                        üëã Hi! I can help you record transactions. Try saying: "sold 10 handwash @70 each" or "bought 5 phenyl for 250"
                                    </div>
                                </div>
                                <form id="chatbotForm" class="mt-4 flex">
                                    <input id="chatbotInput" type="text" placeholder="e.g., sold 10 handwash @70 each to rajesh" class="flex-grow p-3 border border-gray-300 rounded-l-md focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                    <button type="submit" class="bg-indigo-600 text-white px-6 rounded-r-md font-semibold hover:bg-indigo-700 transition duration-200">Send</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                         <h2 class="text-xl font-semibold mb-4">üìã All Transactions</h2>
                         <div class="overflow-x-auto">
                            <div class="max-h-96 overflow-y-auto border border-gray-200 rounded-md">
                                <table class="w-full text-sm">
                                    <thead class="sticky top-0 bg-gray-100 z-10">
                                        <tr class="text-left">
                                            <th class="py-3 px-3 font-semibold">Date</th>
                                            <th class="py-3 px-3 font-semibold">Type</th>
                                            <th class="py-3 px-3 font-semibold">Party</th>
                                            <th class="py-3 px-3 font-semibold">Product</th>
                                            <th class="py-3 px-3 font-semibold text-center">Qty</th>
                                            <th class="py-3 px-3 font-semibold text-right">Amount</th>
                                            <th class="py-3 px-3 font-semibold text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allTransactionsTableBody"></tbody>
                                </table>
                            </div>
                         </div>
                    </div>
                </div>
                
                <!-- Sales Report Tab -->
                 <div id="salesReportContent" class="tab-content hidden bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4">üìä Detailed Sales Report</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="bg-gray-100 text-left">
                                    <th class="p-3">Date</th>
                                    <th class="p-3">Customer</th>
                                    <th class="p-3">Product</th>
                                    <th class="p-3 text-center">Quantity</th>
                                    <th class="p-3 text-right">Amount</th>
                                </tr>
                            </thead>
                            <tbody id="salesReportBody"></tbody>
                            <tfoot>
                                <tr class="font-bold bg-gray-50">
                                    <td colspan="4" class="p-3 text-right">Total Revenue:</td>
                                    <td id="totalSalesRevenue" class="p-3 text-right text-lg"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <!-- Inventory Tab -->
                <div id="inventoryContent" class="tab-content hidden bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4">üì¶ Live Inventory Report</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="bg-gray-100 text-left">
                                    <th class="p-3">Product</th>
                                    <th class="p-3 text-center">Purchased (In)</th>
                                    <th class="p-3 text-center">Sold (Out)</th>
                                    <th class="p-3 text-center">Closing Stock</th>
                                    <th class="p-3 text-right">Stock Value</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryReportBody"></tbody>
                            <tfoot>
                                <tr class="font-bold bg-gray-50">
                                    <td colspan="4" class="p-3 text-right">Total Inventory Value:</td>
                                    <td id="totalInventoryValue" class="p-3 text-right text-lg"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <!-- Unit Economics Tab -->
                <div id="economicsContent" class="tab-content hidden bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4">üí∞ Product Unit Economics</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="bg-gray-100 text-left">
                                    <th class="p-3">Product</th>
                                    <th class="p-3 text-right">Avg. Selling Price</th>
                                    <th class="p-3 text-right">Avg. Cost Price</th>
                                    <th class="p-3 text-right">Gross Profit/Unit</th>
                                    <th class="p-3 text-right">Gross Margin %</th>
                                </tr>
                            </thead>
                            <tbody id="unitEconomicsBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Financials Tab -->
                <div id="financialsContent" class="tab-content hidden space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-lg shadow-md">
                            <h3 class="font-semibold mb-4">üìà Profit & Loss Statement</h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between p-3 bg-gray-50 rounded-md">
                                    <span class="font-medium text-gray-700">Total Sales</span>
                                    <span id="plSales" class="font-bold text-green-600">‚Çπ0.00</span>
                                </div>
                                <div class="flex justify-between p-3 bg-gray-50 rounded-md">
                                    <span class="font-medium text-gray-700">Cost of Goods Sold</span>
                                    <span id="plCogs" class="font-bold text-red-600">‚Çπ0.00</span>
                                </div>
                                <div class="flex justify-between p-3 bg-blue-100 font-bold rounded-md">
                                    <span>Gross Profit</span>
                                    <span id="plGrossProfit" class="text-blue-600">‚Çπ0.00</span>
                                </div>
                                <div class="flex justify-between p-3 bg-gray-50 rounded-md">
                                    <span class="font-medium text-gray-700">Operating Expenses</span>
                                    <span id="plExpenses" class="font-bold text-red-600">‚Çπ0.00</span>
                                </div>
                                <div class="flex justify-between p-3 bg-green-100 font-bold rounded-md border-2 border-green-200">
                                    <span class="text-lg">Net Profit</span>
                                    <span id="plNetProfit" class="text-lg text-green-600">‚Çπ0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg shadow-md">
                            <h3 class="font-semibold mb-4">üí∞ Balance Sheet (Assets)</h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between p-3 bg-gray-50 rounded-md">
                                    <span class="font-medium text-gray-700">Cash & Bank</span>
                                    <span id="bsCash" class="font-bold">‚Çπ0.00</span>
                                </div>
                                <div class="flex justify-between p-3 bg-gray-50 rounded-md">
                                    <span class="font-medium text-gray-700">Inventory</span>
                                    <span id="bsInventory" class="font-bold">‚Çπ0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-lg shadow-md">
                            <h3 class="font-semibold mb-4">üìö Journal Entries</h3>
                            <div class="h-64 overflow-y-auto border border-gray-200 rounded-md">
                                <table class="w-full text-xs">
                                    <thead>
                                        <tr class="bg-gray-50 sticky top-0">
                                            <th class="p-2 text-left">Date</th>
                                            <th class="p-2 text-left">Account</th>
                                            <th class="p-2 text-right">Debit</th>
                                            <th class="p-2 text-right">Credit</th>
                                        </tr>
                                    </thead>
                                    <tbody id="journalBody"></tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg shadow-md">
                            <h3 class="font-semibold mb-4">‚öñÔ∏è Trial Balance</h3>
                            <div class="h-64 overflow-y-auto border border-gray-200 rounded-md">
                                <table class="w-full text-xs">
                                    <thead>
                                        <tr class="bg-gray-50 sticky top-0">
                                            <th class="p-2 text-left">Account</th>
                                            <th class="p-2 text-right">Debit</th>
                                            <th class="p-2 text-right">Credit</th>
                                        </tr>
                                    </thead>
                                    <tbody id="trialBalanceBody"></tbody>
                                    <tfoot>
                                        <tr class="font-bold bg-gray-100 sticky bottom-0">
                                            <td class="p-2">Total</td>
                                            <td id="tbTotalDebit" class="p-2 text-right"></td>
                                            <td id="tbTotalCredit" class="p-2 text-right"></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">üë• Party Ledgers (Account Books)</h3>
                            <select id="partyLedgerSelect" class="p-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none"></select>
                        </div>
                        <div class="h-80 overflow-y-auto border border-gray-200 rounded-md">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="bg-gray-50 sticky top-0">
                                        <th class="p-3 text-left">Date</th>
                                        <th class="p-3 text-left">Particulars</th>
                                        <th class="p-3 text-right">Debit</th>
                                        <th class="p-3 text-right">Credit</th>
                                        <th class="p-3 text-right">Balance</th>
                                    </tr>
                                </thead>
                                <tbody id="partyLedgerBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
</body>
</html>'''

# Save the complete corrected HTML code
with open('corrected_aqua_trust_erp.html', 'w', encoding='utf-8') as f:
    f.write(html_code)

print("‚úÖ Complete corrected ERP code generated!")
print("\n=== KEY IMPROVEMENTS MADE ===")
print("1. ‚úÖ REAL Firebase Configuration (your actual API keys)")
print("2. ‚úÖ Proper Authentication System (Email/Password + Guest)")  
print("3. ‚úÖ Enhanced Security with user-based data isolation")
print("4. ‚úÖ Professional UI with Aqua Trust branding")
print("5. ‚úÖ Better error handling and user feedback")
print("6. ‚úÖ Improved chatbot with natural language processing")
print("7. ‚úÖ Color-coded transaction types and status indicators")
print("8. ‚úÖ Mobile-responsive design")
print("9. ‚úÖ Real-time data synchronization")
print("10. ‚úÖ Complete business logic for FMCG operations")
print("\n=== NEXT STEPS ===")
print("1. Upload this HTML file to your GitHub repository")
print("2. Enable GitHub Pages in repository settings") 
print("3. Configure Firestore security rules")
print("4. Add your GitHub Pages domain to Firebase authorized domains")
print("5. Test your application!")
